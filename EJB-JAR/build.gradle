apply plugin: 'java'
apply plugin: 'ear'
version "1.0"

defaultTasks = ['clean', 'flyJar', 'flyEar']

repositories {
    mavenCentral()
}

dependencies {
    compileOnly fileTree(dir: '../../../Server/wildfly-14.0.1.Final/modules/system/layers/base/', include: '**/*.jar')
    compile group: 'org.flywaydb', name: 'flyway-core', version: '5.2.0'

    earlib group: 'org.flywaydb', name: 'flyway-core', version: '5.2.0'

}


sourceSets {
    main {
        java {
            srcDirs = ['src']
            outputDir = file('out/bin')
            compileClasspath += configurations.compileOnly
        }
    }
}


task flyJar(type: Jar) {

    baseName = 'flyway'
    classifier = 'ejb'
    version = this.version

    from sourceSets.main.output
    destinationDir = file("out/jars")

    from("resources") {
        include "**"
        exclude "xml"
        into "META-INF"
    }

    from("resources/xml") {
        include "**"
        into "META-INF"
    }

}

task flyEar(type: Ear) {
    dependsOn flyJar
    from flyJar
    libDirName 'lib'
    destinationDir = file("out/jars")
    deploymentDescriptor {
        applicationName = "flyway"
        displayName = "flyway"
        module("flyway-1.0-ejb.jar", "ejb")
    }
}


task list(dependsOn: configurations.compile) {
    doLast {
        println "classpath = ${configurations.compile.collect { File file -> file.name }}"
    }
}
