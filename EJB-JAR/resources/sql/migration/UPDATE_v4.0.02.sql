-- PIMCORE 2430
ALTER TABLE ATTRIBUTE ADD DIMENSIONLEVEL NUMBER(1) DEFAULT 0 NOT NULL;

-- PIMCORE 2432
ALTER TABLE ERP_IMPORT_ARTICLE_AV ADD DIMENSION NUMBER(1);

-- PIMCORE-2428
CREATE TABLE ARTICLE_DIMENSION(
    ID                  NUMBER(19)          NOT NULL,
    IDENTIFIER          VARCHAR2(254 CHAR)  NOT NULL,
    PARENTARTICLE       NUMBER(19)          NOT NULL,
    DIMENSION           NUMBER(19)          NOT NULL,
    CREATIONDATE        TIMESTAMP           NOT NULL,
    LASTMODIFIED        TIMESTAMP           NOT NULL,
    UPDATEUSER          NUMBER(19)          NOT NULL,
    CREATEUSER          NUMBER(19)          NOT NULL,
    CONSTRAINT PK_ART_DIM PRIMARY KEY (ID),
    CONSTRAINT FK_ART_DIM_ART FOREIGN KEY(PARENTARTICLE)
        REFERENCES ARTICLE(ID)
        ON DELETE CASCADE,
    CONSTRAINT FK_ART_DIM_DIM FOREIGN KEY(DIMENSION)
        REFERENCES ATTRIBUTE_VALUE(ID),
    CONSTRAINT PK_ART_DIM_UU FOREIGN KEY(UPDATEUSER)
        REFERENCES USERS(ID),
    CONSTRAINT PK_ART_DIM_CU FOREIGN KEY(CREATEUSER)
        REFERENCES USERS(ID)
);

CREATE INDEX I_ART_DIM_1 ON ARTICLE_DIMENSION(PARENTARTICLE);

ALTER TABLE ARTICLE ADD DIMENSION NUMBER(19);
ALTER TABLE ARTICLE ADD CONSTRAINT FK_ART_DIMENSION FOREIGN KEY(DIMENSION) REFERENCES ARTICLE_DIMENSION(ID) ON DELETE CASCADE;

ALTER TABLE ARTICLE_AV ADD DIMENSION NUMBER(19);
ALTER TABLE ARTICLE_AV ADD CONSTRAINT FK_AAV_DIM FOREIGN KEY(DIMENSION) REFERENCES ARTICLE_DIMENSION(ID) ON DELETE CASCADE;

ALTER TABLE ARTICLE_CSG_REL ADD DIMENSION NUMBER(19);
ALTER TABLE ARTICLE_CSG_REL ADD CONSTRAINT FK_CSG_ART_DIM FOREIGN KEY(DIMENSION) REFERENCES ARTICLE_DIMENSION(ID) ON DELETE CASCADE;

ALTER TABLE ARTICLE_ASSET_REL ADD DIMENSION NUMBER(19);
ALTER TABLE ARTICLE_ASSET_REL ADD CONSTRAINT FK_AAR_DIM FOREIGN KEY(DIMENSION) REFERENCES ARTICLE_DIMENSION(ID) ON DELETE CASCADE;

ALTER TABLE ARTICLE_DETAIL_TAB ADD DIMENSION NUMBER(19);
ALTER TABLE ARTICLE_DETAIL_TAB ADD CONSTRAINT FK_ADT_DIM FOREIGN KEY(DIMENSION) REFERENCES ARTICLE_DIMENSION(ID) ON DELETE CASCADE;

ALTER TABLE NODE_ARTICLE_REL ADD DIMENSION NUMBER(19);
ALTER TABLE NODE_ARTICLE_REL ADD CONSTRAINT FK_NAR_DIM FOREIGN KEY(DIMENSION) REFERENCES ARTICLE_DIMENSION(ID) ON DELETE CASCADE;

-- PIMCORE-2472
ALTER TABLE REPORT ADD FILENAME VARCHAR2(254 CHAR);
ALTER TABLE REPORT ADD FILENAMEDATEFORMAT VARCHAR2(254 CHAR);
ALTER TABLE REPORT ADD FILETRANSFERPROFILE NUMBER(19);
ALTER TABLE REPORT ADD CONSTRAINT FK_REPORT_FTP FOREIGN KEY(FILETRANSFERPROFILE) REFERENCES DATAFEED_TRANSFER(ID) ON DELETE SET NULL;

-- PIMCORE-2482
CREATE TABLE WORKFLOW_PROCESS(
    ID              NUMBER(19)              NOT NULL,
    IDENTIFIER      VARCHAR2(254 CHAR)      NOT NULL,
    DESCRIPTION     NUMBER(19),
    CREATIONDATE    TIMESTAMP               NOT NULL,
    LASTMODIFIED    TIMESTAMP               NOT NULL,
    UPDATEUSER      NUMBER(19)              NOT NULL,
    CREATEUSER      NUMBER(19)              NOT NULL,
    CONSTRAINT PK_WORKFLOW_PROCESS PRIMARY KEY (ID),
    CONSTRAINT FK_WORKFLOW_PROCESS_UU FOREIGN KEY(UPDATEUSER)
        REFERENCES USERS(ID),
    CONSTRAINT FK_WORKFLOW_PROCESS_CU FOREIGN KEY(CREATEUSER)
        REFERENCES USERS(ID)
);

ALTER TABLE WORKFLOW ADD WORKFLOWPROCESS NUMBER(19);
ALTER TABLE WORKFLOW ADD SEQUENCENO NUMBER(19);
ALTER TABLE WORKFLOW ADD WORKFLOWSTART NUMBER(1);
ALTER TABLE WORKFLOW ADD CONSTRAINT FK_WORKFLOW_WP FOREIGN KEY(WORKFLOWPROCESS) REFERENCES WORKFLOW_PROCESS(ID);

ALTER TABLE REQUIREMENT ADD NAME NUMBER(19);
ALTER TABLE IMPACT_WORKFLOW ADD NAME NUMBER(19);
ALTER TABLE IMPACT_TRANSITION ADD NAME NUMBER(19);
ALTER TABLE CONDITION ADD NAME NUMBER(19);

-- PIMCORE-2511
INSERT INTO USER_RIGHT (ID, IDENTIFIER, DESCRIPTION, PARENTID, ISMASTERDATA, CREATIONDATE, LASTMODIFIED, UPDATEUSER, CREATEUSER) VALUES (160012, 'Bulk input - Edit table', null, 160000, 1, sysdate, sysdate, 1, 1);
INSERT INTO USER_ROLE_USER_RIGHT_REL select seq_basic_id.nextval, userrole, 160012, sysdate, sysdate, 1, 1 FROM USER_ROLE_USER_RIGHT_REL WHERE userright = 160000;

-- PIMCORE-2423
CREATE INDEX IDX_AUDIT_LOG_GUID ON AUDIT_LOG(GUID);

-- PIMCORE-2497
INSERT INTO PLUGIN (ID, IDENTIFIER, DESCRIPTION, ENABLED, CONFIGURED, PREFIX, HASCONFIGAPP, CONFIGAPP, CREATIONDATE, LASTMODIFIED, UPDATEUSER, CREATEUSER) VALUES (18, 'StandardXMLExport', 10017, 0, 0, 'dataexport.standardxml', 0, null, sysdate, sysdate, 1, 1);
INSERT INTO locale_lookuptext (ID, LOCALE, TEXTID, TEXT, CREATIONDATE, LASTMODIFIED, UPDATEUSER, CREATEUSER) VALUES (10017, 2, 10017, 'Standard XML-Export-Plugin', sysdate, sysdate, 1, 1);
INSERT INTO locale_lookuptext (ID, LOCALE, TEXTID, TEXT, CREATIONDATE, LASTMODIFIED, UPDATEUSER, CREATEUSER) VALUES (10517, 1, 10017, 'Standard XML export plugin', sysdate, sysdate, 1, 1);

-- ID
UPDATE SERVER_PROPERTY SET PROPERTYVALUE='v4.0.02', LASTMODIFIED=sysdate WHERE PROPERTYKEY='server.id';
